---
// BlogPostLayout.astro — wraps individual blog post markdown pages
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  date: Date;
  category: string;
  excerpt: string;
  readTime?: string;
}

const { title, date, category, excerpt, readTime } = Astro.props;

const formattedDate = new Date(date).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout
  title={`${title} | Anurag Jain`}
  description={excerpt}
  ogTitle={title}
  ogUrl={Astro.url.href}
  bodyDataPage="blog-post"
>
  <Fragment slot="head">
    <style>
      body[data-page="blog-post"] {
        background: #05070f;
      }

      /* Reading progress bar */
      #read-progress {
        position: fixed;
        top: 0; left: 0;
        width: 0%;
        height: 5px;
        z-index: 9999;
        background: linear-gradient(90deg, #60a5fa, #38bdf8, #34d399);
        border-radius: 0 3px 3px 0;
        transition: width 0.08s linear;
        box-shadow: 0 0 14px rgba(56, 189, 248, 0.85), 0 0 4px rgba(56, 189, 248, 0.6);
      }

      /* Back button */
      .post-back {
        position: fixed;
        top: 18px; left: 18px;
        z-index: 1000;
        padding: 0.44rem 0.9rem;
        border-radius: 999px;
        text-decoration: none;
        background: rgba(8, 12, 24, 0.72);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(96, 165, 250, 0.25);
        color: var(--text-secondary);
        font-size: 0.84rem;
        transition: border-color 0.18s, color 0.18s, transform 0.18s;
      }
      .post-back:hover {
        border-color: rgba(56, 189, 248, 0.5);
        color: var(--text-primary);
        transform: translateX(-2px);
      }

      /* Hero header */
      .post-hero {
        position: relative;
        padding: clamp(6rem, 12vw, 9rem) clamp(1.5rem, 6vw, 3rem) clamp(3rem, 6vw, 4.5rem);
        text-align: center;
        overflow: hidden;
      }
      .post-hero::before {
        content: "";
        position: absolute;
        inset: 0;
        background:
          radial-gradient(ellipse 70% 55% at 50% 0%, rgba(56, 189, 248, 0.1), transparent 70%),
          radial-gradient(ellipse 50% 40% at 80% 80%, rgba(96, 165, 250, 0.07), transparent 60%);
        pointer-events: none;
      }
      .post-hero::after {
        content: "";
        position: absolute;
        bottom: 0; left: 50%;
        transform: translateX(-50%);
        width: min(680px, 90%);
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.3), transparent);
      }

      .post-cat {
        display: inline-block;
        font-size: 0.68rem;
        font-weight: 700;
        letter-spacing: 0.13em;
        text-transform: uppercase;
        color: var(--accent-secondary);
        background: rgba(96, 165, 250, 0.1);
        border: 1px solid rgba(96, 165, 250, 0.25);
        padding: 0.3rem 0.9rem;
        border-radius: 999px;
        margin-bottom: 1.4rem;
      }

      .post-title {
        font-size: clamp(2rem, 4.5vw, 3.2rem);
        font-weight: 750;
        line-height: 1.12;
        letter-spacing: -0.02em;
        color: var(--text-primary);
        margin: 0 auto 1.2rem;
        max-width: 960px;
      }

      .post-excerpt {
        font-size: clamp(1rem, 1.4vw, 1.18rem);
        color: var(--text-secondary);
        line-height: 1.65;
        max-width: 720px;
        margin: 0 auto 1.8rem;
        opacity: 0.85;
      }

      .post-meta {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.82rem;
        color: var(--muted);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        padding: 0.45rem 1rem;
        border-radius: 999px;
      }
      .post-meta .sep { opacity: 0.35; }

      /* Content shell */
      .post-shell {
        max-width: 900px;
        margin: 0 auto;
        padding: clamp(2.5rem, 5vw, 4rem) clamp(1.5rem, 5vw, 3rem) clamp(3rem, 6vw, 6rem);
      }

      /* Prose */
      .post-body {
        color: var(--text-secondary);
        line-height: 1.85;
        font-size: clamp(1rem, 1.15vw, 1.1rem);
      }

      .post-body > * + * { margin-top: 1.4rem; }

      .post-body h2 {
        font-size: clamp(1.4rem, 2.2vw, 1.8rem);
        font-weight: 700;
        color: var(--text-primary);
        margin: 3rem 0 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255,255,255,0.07);
      }
      .post-body h3 {
        font-size: clamp(1.1rem, 1.7vw, 1.35rem);
        font-weight: 650;
        color: var(--text-primary);
        margin: 2.2rem 0 0.7rem;
      }
      .post-body h4 {
        font-size: 1rem;
        font-weight: 650;
        color: var(--text-primary);
        margin: 1.8rem 0 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-size: 0.82rem;
        color: var(--accent-secondary);
      }

      .post-body p { margin-bottom: 1.4rem; }

      .post-body a {
        color: var(--accent);
        text-decoration: underline;
        text-underline-offset: 3px;
        text-decoration-color: rgba(56, 189, 248, 0.4);
        transition: text-decoration-color 0.15s, color 0.15s;
      }
      .post-body a:hover {
        color: var(--accent-secondary);
        text-decoration-color: var(--accent-secondary);
      }

      .post-body ul, .post-body ol {
        padding-left: 1.6rem;
        margin-bottom: 1.4rem;
        display: grid;
        gap: 0.45rem;
      }
      .post-body ul li::marker { color: var(--accent); }
      .post-body ol li::marker { color: var(--accent-secondary); font-weight: 600; }

      .post-body strong { color: var(--text-primary); font-weight: 650; }
      .post-body em { color: var(--text-primary); opacity: 0.85; }

      /* Inline code */
      .post-body :not(pre) > code {
        font-family: 'Fira Code', 'Cascadia Code', 'JetBrains Mono', monospace;
        font-size: 0.86em;
        background: rgba(56, 189, 248, 0.1);
        border: 1px solid rgba(56, 189, 248, 0.2);
        padding: 0.12em 0.45em;
        border-radius: 5px;
        color: var(--accent);
      }

      /* Code blocks */
      .post-body pre {
        position: relative;
        background: rgba(6, 10, 22, 0.95);
        border: 1px solid rgba(255,255,255,0.08);
        border-top: 2px solid rgba(56, 189, 248, 0.35);
        border-radius: 12px;
        padding: 1.4rem 1.6rem;
        overflow-x: auto;
        margin: 1.8rem 0;
        box-shadow: 0 16px 40px rgba(0,0,0,0.35);
      }
      .post-body pre::before {
        content: "";
        position: absolute;
        top: 0; left: 0; right: 0;
        height: 32px;
        background: rgba(255,255,255,0.025);
        border-radius: 10px 10px 0 0;
      }
      .post-body pre code {
        background: none;
        border: none;
        padding: 0;
        color: #cdd6f4;
        font-size: 0.9em;
        line-height: 1.7;
        font-family: 'Fira Code', 'Cascadia Code', 'JetBrains Mono', monospace;
      }

      /* Blockquote */
      .post-body blockquote {
        position: relative;
        border-left: 3px solid var(--accent);
        background: rgba(56, 189, 248, 0.05);
        border-radius: 0 10px 10px 0;
        padding: 1.1rem 1.4rem;
        margin: 1.8rem 0;
        color: var(--text-secondary);
        font-style: italic;
        font-size: 1.06em;
        line-height: 1.75;
      }
      .post-body blockquote p { margin: 0; }
      .post-body blockquote p + p { margin-top: 0.6rem; }

      /* HR */
      .post-body hr {
        border: none;
        margin: 2.8rem 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.25), transparent);
      }

      /* Images */
      .post-body img {
        max-width: 100%;
        border-radius: 12px;
        margin: 1.6rem 0;
        border: 1px solid rgba(255,255,255,0.07);
        box-shadow: 0 12px 32px rgba(0,0,0,0.3);
      }

      /* Table */
      .post-body table {
        width: 100%;
        border-collapse: collapse;
        margin: 1.8rem 0;
        font-size: 0.93em;
      }
      .post-body th {
        text-align: left;
        padding: 0.7rem 1rem;
        background: rgba(255,255,255,0.05);
        color: var(--text-primary);
        font-weight: 650;
        border-bottom: 1px solid rgba(255,255,255,0.1);
      }
      .post-body td {
        padding: 0.65rem 1rem;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        color: var(--text-secondary);
      }
      .post-body tr:last-child td { border-bottom: none; }

      /* Post footer */
      .post-footer {
        max-width: 900px;
        margin: 0 auto;
        padding: 0 clamp(1.5rem, 5vw, 3rem) clamp(4rem, 8vw, 6rem);
      }
      .post-footer-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
        padding: 1.4rem 1.6rem;
        border-radius: 14px;
        border: 1px solid rgba(255,255,255,0.08);
        background: rgba(255,255,255,0.03);
      }
      .post-footer-label {
        font-size: 0.82rem;
        color: var(--muted);
      }
      .post-footer-cta {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--accent);
        text-decoration: none;
        transition: gap 0.15s ease, color 0.15s;
      }
      .post-footer-cta:hover { gap: 0.65rem; color: var(--accent-secondary); }

      @media (max-width: 640px) {
        .post-hero { text-align: left; }
        .post-meta { font-size: 0.78rem; }
        .post-footer-inner { flex-direction: column; align-items: flex-start; }
      }
    </style>
  </Fragment>

  <!-- Reading progress bar -->
  <div id="read-progress" aria-hidden="true"></div>

  <!-- Back button -->
  <a class="post-back" href="/blog">← All Posts</a>

  <!-- Hero -->
  <header class="post-hero">
    <span class="post-cat">{category}</span>
    <h1 class="post-title">{title}</h1>
    <p class="post-excerpt">{excerpt}</p>
    <div class="post-meta">
      <time datetime={date.toISOString()}>{formattedDate}</time>
      {readTime && <><span class="sep">·</span><span>{readTime}</span></>}
    </div>
  </header>

  <!-- Body -->
  <main class="post-shell">
    <article class="post-body">
      <slot />
    </article>
  </main>

  <!-- Footer -->
  <footer class="post-footer">
    <div class="post-footer-inner">
      <span class="post-footer-label">Thanks for reading</span>
      <a class="post-footer-cta" href="/blog">← Back to all posts</a>
    </div>
  </footer>

  <script>
    // Reading progress bar
    const bar = document.getElementById('read-progress');
    if (bar) {
      const update = () => {
        const scroll = window.scrollY;
        const height = document.documentElement.scrollHeight - window.innerHeight;
        bar.style.width = height > 0 ? `${(scroll / height) * 100}%` : '0%';
      };
      window.addEventListener('scroll', update, { passive: true });
      update();
    }
  </script>
</BaseLayout>
